<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="/favicon.ico" sizes="32x32">
    <link rel="icon" href="/static/favicon.svg" type="image/svg+xml">
    <link rel="icon" href="/static/favicon-96x96.png" type="image/png" sizes="96x96">
    <link rel="apple-touch-icon" href="/static/apple-touch-icon.png">
    <link rel="manifest" href="/static/site.webmanifest">
    <script>
      window.__CP_DEBUG = {{ CP_DEBUG|tojson }};
      if (!window.__CP_DEBUG) { try { console.debug = function(){} } catch(e){} }
    </script>
    <title>Badge Detail</title>
    <link href="/static/vendor/bootstrap.min.css" rel="stylesheet">
  </head>
  <body class="p-4">
    {% include '_ribbon.html' %}
    <div class="container py-4">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 class="h3" id="badgeName">Badge</h1>
        <div>
          <a href="/badges" class="btn btn-outline-secondary btn-sm">Back</a>
        </div>
      </div>

      <div class="card p-3">
        <div class="d-flex align-items-center gap-3">
          <img id="badgeImg" src="" style="max-width:100px" />
          <div>
            <h4 id="badgeTitle"></h4>
            <p id="badgeDesc" class="text-muted"></p>
            <div id="earnedList" class="mt-2"></div>
          </div>
        </div>
      </div>
    </div>

    <script>
      const name = decodeURIComponent(location.pathname.split('/').pop());
      async function load(){
        const r = await fetch('/api/badges');
        if (!r.ok) return;
        const j = await r.json();
        const catalog = j.catalog || {};
        const meta = catalog[name] || {};
        document.getElementById('badgeName').textContent = name;
        document.getElementById('badgeTitle').textContent = name;
        document.getElementById('badgeDesc').textContent = meta.description || '';
        document.getElementById('badgeImg').src = '/static/img/badges/' + (meta.icon || 'default.svg');
        const earned = (j.badges || []).filter(b => b.name === name);
        const el = document.getElementById('earnedList');
        if (!earned.length) el.innerHTML = '<div class="alert alert-info">You have not earned this badge yet.</div>';
        else{
          el.innerHTML = '<h6>Earned</h6>' + earned.map(b=>`<div>${new Date(b.awarded_at).toLocaleString()}</div>`).join('');
        }
      }
      load();
    </script>
    <script src="/static/js/ribbon.js"></script>
    <script>document.addEventListener('DOMContentLoaded', ()=>{ if (window.initRibbon) initRibbon() })</script>
  </body>
</html>
